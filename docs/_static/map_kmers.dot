digraph {

		node[shape=ellipse];
		make_query_fa[label=<make query fasta file>];
		bwa_mem[label=<bwa mem>];
		make_query_bed[label=<make query bed file from hits>];
		bedtools_intersect[label=<bedtools intersect>];
		get_gene_info[label=<get info about mapped genes>];

		node[shape=folder];
		references[label=<references>];

		node[shape=note];
		gene_infos[label=<gene info>];
		unmapped_kmers[label=<unmapped kmers>];
		query_fa[label=<query fasta file>];
		reference_fa[label=<reference fasta file>];
		reference_bed[label=<reference bed file>];
		mapped_kmers[label=<mapped kmers>];
		query_bed[label=<query bed file>];

		unmapped_kmers -> make_query_fa -> query_fa;

		references -> reference_fa;
		references -> reference_bed;
		

		reference_fa -> bwa_mem;
		query_fa -> bwa_mem;
		bwa_mem -> make_query_bed -> query_bed;
		query_bed -> bedtools_intersect;
		reference_bed -> bedtools_intersect;

		bedtools_intersect -> mapped_kmers;
		bedtools_intersect -> unmapped_kmers;
		bedtools_intersect -> get_gene_info -> gene_infos;

		edge[style=invis]
		reference_fa -> reference_bed

		{rank = same; query_fa; reference_fa}
		{rank = same; unmapped_kmers; make_query_fa}
	

}
